---
title: redis数据结构-sds
date: 2017-11-10 17:30:27
categories:
- redis
---

## redis数据结构

### SDS结构
<!--more-->


```c
struct sdshdr{
//记录buf数组中已使用字节数量，等于SDS保存的字符串长度
int len;
//记录buf数组未使用字节的数量
int free
//字节数组，用于保存字符串
char buf[]

}

```
SDS最后一个字节保存了空字符'\0'

### SDS 简单动态字符串
SDS是redis默认字符串，与C字符串略有不同。

#### 常数复杂度获取字符串长度
由len可直接获取长度，复杂度为O(1),而C字符串需要遍历整合字符串，复杂度为O(N)。

#### 杜绝缓冲区溢出
C字符串不记录自身长度，若内存中紧邻的两个字符串，由于未给其中一个分配足够内存，修改其值时，会修改另一个字符串的值，数据溢出。SDS在修改时会首先检查空间是否满足要求，若靠近啊不能满足，自动增加。

#### 减少修改字符串时带来的内存重新分配次数
通过一些空间分配策略，减少修改时的内存重新分配次数。
（空间预分配，惰性空间释放）

#### 二进制安全
C字符串必须符合魔宗编码，并且除了字符串结尾，不能包含空字符串，否则会误认为是字符串结尾，这些限制了其只能保存文本数据，不能保存图片，音频，视频，压缩文件这样的二进制数据。

#### 兼容部分C字符串函数
SDS最后一个字节保存了空字符'\0'，遵循了C字符串以空字符串结尾的惯例，可以重用一部分<string.h>库定义的函数，避免了重复造轮子。