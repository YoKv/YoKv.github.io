---
title: 观察者模式
date: 2017-07-21 21:19:10
categories:
- 设计模式
---

## 观察者模式
本文为Head First设计模式第二章阅读笔记。观察者模式定义了对象间的一对多的依赖关系,当一个对象发生变化时，它的所有依赖者都会受到通知，并自动更新。
<!--more-->
观察者模式提供了一种松耦合的方式，
*设计原则：*为了交互对象之间的松耦合设计而努力。

## 代码

主题接口，注册、删除和通知观察者
```java
public interface Subject {
    /**
     * 注册
     *
     * @param observer
     */
    void registerObserver(Observer observer);

    /**
     * 删除
     *
     * @param observer
     */
    void removeObserver(Observer observer);

    /**
     * 主题状态变化时，通知观察者
     */
    void notifyObserver();
}
```

主题实现类，气象数据类
```java
public class WeatherData implements Subject {
    /**
     * 观察者
     */
    private ArrayList<Observer> observers;
    /**
     * 温度
     */
    private float temperature;
    /**
     * 湿度
     */
    private float humidity;
    /**
     * 气压
     */
    private float pressure;

    public WeatherData() {
        this.observers = new ArrayList();
    }

    @Override
    public void registerObserver(Observer observer) {
        observers.add(observer);
    }

    @Override
    public void removeObserver(Observer observer) {
        observers.remove(observer);
    }

    @Override
    public void notifyObserver() {
        for (Observer observer : observers) {
            observer.update(temperature, humidity, pressure);
        }
    }

    /**
     * 数据更新时通知观察者
     */
    public void measurementsChanged() {
        notifyObserver();
    }

    /**
     * 程序内改变气象信息
     *
     * @param temperature
     * @param humidity
     * @param pressure
     */
    public void setMeasurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        measurementsChanged();
    }

}

```

观察者接口
```java
public interface Observer {
    /**
     *
     * @param temp
     * @param humidity
     * @param pressure
     */
    void update(float temp,float humidity,float pressure);

}
```

布告栏接口
```java
public interface DisplayElement {
    /**
     * 显示
     */
    void display();
}
```

播报实时气象信息的布告栏类
```java
public class CurrentConditionDispaly implements Observer, DisplayElement {
    private float temperature;
    private float humidity;
    private Subject weatherData;

    public CurrentConditionDispaly(Subject weatherData) {
        this.weatherData = weatherData;
        weatherData.registerObserver(this);
    }

    @Override
    public void display() {
        System.out.println("CurrentCondition temperature: " + temperature + " humidity: " + humidity);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        this.temperature = temp;
        this.humidity = humidity;

        display();
    }
}
```

测试
```java
    @Test
    public void test() {
        WeatherData weatherData = new WeatherData();

        new CurrentConditionDispaly(weatherData);

        weatherData.setMeasurements(41, 70, 52);

    }
```

## jdk支持
java.util包中，提供了Observable类以及Observer接口

主题实现类，气象数据类jdk实现
```java
public class WeatherDataJdk extends Observable {
    /**
     * 温度
     */
    private float temperature;
    /**
     * 湿度
     */
    private float humidity;
    /**
     * 气压
     */
    private float pressure;


    /**
     * 数据更新时通知观察者
     */
    public void measurementsChanged() {
        setChanged();
        notifyObservers();
    }

    /**
     * 程序内改变气象信息
     *
     * @param temperature
     * @param humidity
     * @param pressure
     */
    public void setMeasurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        measurementsChanged();
    }

    public float getTemperature() {
        return temperature;
    }

    public float getHumidity() {
        return humidity;
    }

    public float getPressure() {
        return pressure;
    }
}
```

播报实时气象信息的布告栏类jdk实现
```java
public class CurrentConditionDispalyJdk implements java.util.Observer, DisplayElement {
   Observable observable;
    private float temperature;
    private float humidity;


    public CurrentConditionDispalyJdk(Observable observable) {
        this.observable = observable;
        observable.addObserver(this);
    }

    @Override
    public void display() {
        System.out.println("CurrentCondition temperature: " + temperature + " humidity: " + humidity);
    }

    @Override
    public void update(Observable o, Object arg) {
        if(o instanceof WeatherDataJdk){
            WeatherDataJdk weatherDataJdk = (WeatherDataJdk) o;
            this.temperature = weatherDataJdk.getTemperature();
            this.humidity = weatherDataJdk.getHumidity();
            display();
        }
    }

}
```

## 定义
在对象之间定义一对多的依赖，这样一来，当一个对象改变状态，依赖它的对象都会收到通知，并自动更新。

## 代码地址
[相关项目代码](https://coding.net/u/YoKv/p/readingNotes/git/tree/master/design-patterns/src/main/java/space/aiyo/observer)

